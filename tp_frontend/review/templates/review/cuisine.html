{% extends "base.html" %}

{% block title %}Select Cuisine{% endblock %}
{% block content %}
<p><b>{{ current_cuisines  }}</b></p>
    <form action="/cuisine_selection/" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <p>{{ form.non_field_errors }}</p>
        <p>Select {{ form.cuisine.label_tag }}(Select multiple using control or shift key)</p>
        <p>
            {{ form.cuisine.errors }}
            {{ form.cuisine }}
        </p>

         <div id="generate_ques_div" class="col-md-4">
             {% if question_gen_progress == True %}
                <h4>Question Generation in progress &nbsp; &nbsp;<img src="http://jalbum.net/en/resources/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/indicator.gif"></h4>
            {% else %}
                <p><input type="submit" value="Select" /></p>
                <button class="btn btn-primary btn-block btn-large" id="question-gen-btn">Generate Questions</button>
            {% endif %}
         </div>
<style>
#id_cuisine {
 height:500px !important;
width:150px !important;
}
</style>

    </form>

{% endblock content %}
<style>
#id_cuisine {
 height:500px !important;
 line-height:24px !important;
}
</style>

{% block jquery %}
<script>
    $(document).ready(function(){
        $("#question-gen-btn").on("click", function(){
            $('#generate_ques_div').html('<h3>Question Generation in progress &nbsp; &nbsp;<img src="http://jalbum.net/en/resources/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/indicator.gif"></h3>');
            $.post( "/generate-questions/", function() {
            question_gen_process();
            })
            .fail(function() {
                $("#messages-div").html('<div class="alert alert-danger text-center col-md-4 col-md-offset-4" role="alert">Error in Generating questions</div>');
            });
        });
    {% if question_gen_progress == True %}
        question_gen_process();
    {% endif %}
        function question_gen_process(){
            var timeout = setTimeout(question_gen_process, 5000);
             $.ajax({
                  type: "get",
                  url: "/generate-questions/progress",
                }).success(function(data){
                    if (data === "true"){
                        $('#generate_questions_div').html('<h4>Retraining in progress &nbsp; &nbsp;<img src="http://jalbum.net/en/resources/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/indicator.gif"></h4>');
                    }else{
                        $("#messages-div").html('<div class="alert alert-success text-center col-md-4 col-md-offset-4" role="alert">Question Generation Completed</div>');
                        $('#generate_ques_div').html('<p><input type="submit" value="Select" /></p><button class="btn btn-primary btn-block btn-large" id="retrain-btn">Start Retraining</button>')
                        clearTimeout(timeout);
                    }
                }).fail(function(){
                    console.log('source data not found ')
             });


         }
    });
</script>
{% endblock %}
