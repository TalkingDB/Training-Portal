{% extends "base.html" %}

{% block title %}Select Cuisine{% endblock %}
{% block content %}
<p><b>{{ current_cuisines  }}</b></p>
    <form action="/cuisine_selection/" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <p>{{ form.non_field_errors }}</p>
        <p>Select {{ form.cuisine.label_tag }}(Select multiple using control or shift key)</p>
        <p>
            {{ form.cuisine.errors }}
            {{ form.cuisine }}
        </p>
        <p><input type="submit" value="Select" /></p>
    </form>
    <div id="generate_ques_div" class="col-md-4">
         {% if question_gen_progress == True %}
            <h4>Question Generation in progress &nbsp; &nbsp;<img src="http://jalbum.net/en/resources/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/indicator.gif"></h4>
        {% else %}
        <button class="btn btn-primary btn-block btn-large" id="question-gen-btn">Generate Questions</button>
        {% endif %}
    </div>
        <div class="modal fade" id="flush-data-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>&nbsp;Data Flushing Confirmation</h3>
                    </div>
                    <div class="modal-body">
                        <h4>Do you want to flush your previous data including user training and generate new questions ??</h4>
                        <p class="text-muted" style="font-size:12px;"><span class="glyphicon glyphicon-warning-sign text-danger" aria-hidden="true" style="font-size:14px;"></span>
                            Please be careful about selecting option because if you flush your data Smarter.codes removes your training
                            and frequency generated by by your given mturk sheet. Make sure you have uploaded new mturk for question generation.
                        </p>
                        <p class="text-muted" style="font-size:12px;">In case you are not satisfied with new data and want to restore to previous version contact
                            Samrter.codes administrator.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-flush="false">No, Don't Flush Previous Data</button>
                        <button class="btn btn-default" id="flush-data-btn" data-flush="true">Yes, Flush Previous Data</button>
                    </div>
                </div>
            </div>
        </div>
<style>
#id_cuisine {
 height:500px !important;
width:150px !important;
}
</style>

    </form>

{% endblock content %}
<style>
#id_cuisine {
 height:500px !important;
 line-height:24px !important;
}
</style>

{% block jquery %}
<script>
    $(document).ready(function(){
        $("#question-gen-btn").on("click", function(){
            $("#flush-data-modal").modal('show');
            $("#flush-data-modal button").on('click', function(){
                var flush = $(this).data("flush")
                $("#flush-data-modal").modal('hide');
                $('#generate_ques_div').html('<h3>Question Generation in progress &nbsp; &nbsp;<img src="http://jalbum.net/en/resources/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/indicator.gif"></h3>');
                $.post( "/generate-questions/",{"flush-data":flush}, function() {
                question_gen_process();
                })
                .fail(function() {
                    $("#messages-div").html('<div class="alert alert-danger text-center col-md-4 col-md-offset-4" role="alert">Error in Generating questions</div>');
                });
            });
        });
    {% if question_gen_progress == True %}
        question_gen_process();
    {% endif %}
        function question_gen_process(){
            var timeout = setTimeout(question_gen_process, 5000);
             $.ajax({
                  type: "get",
                  url: "/generate-questions/progress",
                }).success(function(data){
                    if (data === "true"){
                        $('#generate_questions_div').html('<h4>Retraining in progress &nbsp; &nbsp;<img src="http://jalbum.net/en/resources/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/indicator.gif"></h4>');
                    }else{
                        $("#messages-div").html('<div class="alert alert-success text-center col-md-4 col-md-offset-4" role="alert">Question Generation Completed</div>');
                        $('#generate_ques_div').html('<p><input type="submit" value="Select" /></p><button class="btn btn-primary btn-block btn-large" id="retrain-btn">Start Retraining</button>')
                        clearTimeout(timeout);
                    }
                }).fail(function(){
                    console.log('source data not found ')
             });


         }
    });
</script>
{% endblock %}
